(()=>{"use strict";function e(){var e=document.querySelector(".clock");if(e){var t=new Date;e.textContent=t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("restart-apache-button");e&&e.addEventListener("click",function(){return e="restart",void((t=document.getElementById("apache-status-message"))&&(t.innerText="Executing "+e+"...",fetch("".concat(window.BASE_URL,"utils/toggle_apache.php"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"action="+encodeURIComponent(e)}).then(function(e){return e.text()}).then(function(e){try{var n=JSON.parse(e);t.innerText=n.message,"function"==typeof renderServerInfo&&renderServerInfo()}catch(n){console.error("Invalid JSON:",e),t.innerText="Error: Invalid server response"}}).catch(function(e){t.innerText="Error: "+e})));var e,t})});var t=new WeakSet;function n(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=document.querySelector(e);if(o&&!t.has(o)){t.add(o);var r=n.items||"li",a=n.handle||null,i=null;o.addEventListener("pointerdown",function(e){var t=e.target.closest(r);t&&o.contains(t)&&(e.target.closest('input, select, textarea, button, a, [contenteditable=""], .no-drag')||a&&!e.target.closest(a)||(t.draggable=!0))},{capture:!0}),o.addEventListener("dragstart",function(e){var t=e.target.closest(r);if(t&&o.contains(t)){i=t,e.dataTransfer.effectAllowed="move";try{e.dataTransfer.setData("text/plain","")}catch(e){}t.classList.add("dragElem")}}),o.addEventListener("dragenter",function(e){var t=e.target.closest(r);t&&o.contains(t)&&t.classList.add("over")}),o.addEventListener("dragover",function(e){i&&e.preventDefault()}),o.addEventListener("dragleave",function(e){var t=e.target.closest(r);t&&o.contains(t)&&t.classList.remove("over")}),o.addEventListener("drop",function(e){e.preventDefault();var t=e.target.closest(r);if(t&&i&&t!==i){var n=Array.from(o.querySelectorAll(":scope > ".concat(r))),a=n.indexOf(i),c=n.indexOf(t);a>-1&&c>-1&&(a<c?t.after(i):t.before(i),o.dispatchEvent(new CustomEvent("sorted",{bubbles:!0}))),t.classList.remove("over")}}),o.addEventListener("dragend",function(e){var t=e.target.closest(r);t&&o.contains(t)&&(t.classList.remove("dragElem"),t.draggable=!1),Array.from(o.querySelectorAll(r)).forEach(function(e){return e.classList.remove("over")}),i=null})}}function o(e){localStorage.setItem("columnSize",e);var t=document.querySelector(".columns");t&&(t.classList.forEach(function(e){e.startsWith("max-")&&t.classList.remove(e)}),"auto"!==e&&t.classList.add(e))}function r(e,t){var n=localStorage.getItem("columnSize")||"auto",r=t.indexOf(n),a=0;"next"===e?a=(r+1)%t.length:"prev"===e&&(a=(r-1+t.length)%t.length),o(t[a])}function a(e){var t=e.sectionId,n=e.toggleButtonId,o=e.logElementId,r=e.endpoint;document.addEventListener("DOMContentLoaded",function(){var e=document.body;if(document.getElementById(t)){var a=document.getElementById(n),i=document.getElementById(o);a&&i&&(a.addEventListener("click",function(){var e=i.classList.contains("visible");i.classList.toggle("visible",!e),this.setAttribute("aria-expanded",!e)}),"true"===e.getAttribute("data-ajax-enabled")&&fetch("".concat(window.BASE_URL).concat(r),{cache:"no-store"}).then(function(e){return e.ok?e.text():Promise.reject()}).then(function(e){c(e),setInterval(l,3e3)}).catch(function(){}))}function c(e){var t=""===e.trim();i.innerHTML=t?'<code class="muted">No errors logged. You\'re doing great. üéâ</code>':"<code>".concat(e,"</code>")}function l(){fetch("".concat(window.BASE_URL).concat(r),{cache:"no-store"}).then(function(e){return e.ok?e.text():Promise.reject()}).then(c)}})}function i(){var e=document.getElementById("export-group"),t=document.getElementById("export-folder"),n=document.getElementById("uploads-mode-row"),o=document.getElementById("export-files-form"),r=document.getElementById("export-files-status"),a=document.getElementById("export-db-form"),i=document.getElementById("export-db"),c=document.getElementById("export-db-status");if(e&&t){var l=[];d(),fetch("".concat(window.BASE_URL,"partials/export.php?action=scan"),{credentials:"same-origin"}).then(function(e){return e.json()}).then(function(n){if(!n.ok)throw new Error(n.error||"Failed to scan folders");if((l=n.groups||[]).length)!function(e,t){e.innerHTML="",t.forEach(function(t){var n=document.createElement("option");n.value=String(t.index),n.textContent=t.title,e.appendChild(n)})}(e,l),e.options.length&&e.dispatchEvent(new Event("change"));else{e.innerHTML='<option value="">No folders defined</option>',e.disabled=!0,t.innerHTML='<option value="">No subfolders</option>',t.disabled=!0;var o=document.getElementById("export-files-status");o&&(o.innerHTML="No folders defined. Add entries to <code>config/folders.json</code> to enable file exports.");var r=document.getElementById("uploads-mode-row");r&&(r.style.display="none")}}).catch(function(n){console.error(n),e.innerHTML='<option value="">Error loading groups</option>',e.disabled=!0,t.innerHTML='<option value="">‚Äî</option>',t.disabled=!0}),fetch("".concat(window.BASE_URL,"partials/export.php?action=dbs"),{credentials:"same-origin"}).then(function(e){return e.json()}).then(function(e){if(!e.ok)throw new Error(e.error||"Failed to list databases");var t,n;t=i,n=e.databases||[],t.innerHTML="",n.length?n.forEach(function(e){var n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)}):t.innerHTML='<option value="">No databases found</option>'}).catch(function(e){console.error(e),i.innerHTML='<option value="">Error loading databases</option>'}),e.addEventListener("change",function(){var o=parseInt(e.value,10),r=Number.isNaN(o)?null:l[o];t.disabled=!0,t.innerHTML='<option value="">Select a group first‚Ä¶</option>',n.style.display="none";var a,i,c=document.querySelector('input[name="uploadsMode"][value="exclude"]');(c&&(c.checked=!0),r)&&(a=t,i=r.subfolders,a.innerHTML="",i.length?i.forEach(function(e){var t=document.createElement("option");t.value=e.name,t.textContent=e.name,a.appendChild(t)}):a.innerHTML='<option value="">No subfolders found</option>',t.disabled=0===r.subfolders.length,r.subfolders.length>0&&(t.selectedIndex=0,t.dispatchEvent(new Event("change"))))}),t.addEventListener("change",function(){var o=parseInt(e.value,10),r=l[o];if(r){var a=r.subfolders.find(function(e){return e.name===t.value}),i=!!(a&&a.isWordPress&&a.hasUploads);n.style.display=i?"":"none";var c=document.querySelector('input[name="uploadsMode"][value="exclude"]');c&&(c.checked=!0)}}),o.addEventListener("submit",function(e){e.preventDefault(),r.textContent="Preparing archive‚Ä¶";var t=new FormData(o);t.append("action","zip"),fetch("".concat(window.BASE_URL,"partials/export.php"),{method:"POST",body:t,credentials:"same-origin"}).then(function(e){return e.json()}).then(function(e){if(!e.ok)throw new Error(e.error||"Export failed");return r.innerHTML='Done. <a href="'.concat(window.BASE_URL).concat(e.href,'" download="').concat(e.name,'">').concat(e.name,"</a>"),window.location.href="".concat(window.BASE_URL).concat(e.href),d()}).catch(function(e){return console.error(e),r.textContent="Error: "+e.message,d()})}),a.addEventListener("submit",function(e){e.preventDefault(),c.textContent="Dumping database‚Ä¶";var t=new FormData(a);t.append("action","dumpdb"),fetch("".concat(window.BASE_URL,"partials/export.php"),{method:"POST",body:t,credentials:"same-origin"}).then(function(e){return e.json()}).then(function(e){if(!e.ok)throw new Error(e.error||"DB export failed");return c.innerHTML='Done. <a href="'.concat(window.BASE_URL).concat(e.href,'" download="').concat(e.name,'">').concat(e.name,"</a>"),window.location.href="".concat(window.BASE_URL).concat(e.href),d()}).catch(function(e){return console.error(e),c.textContent="Error: "+e.message,d()})})}function d(){return fetch("".concat(window.BASE_URL,"partials/export.php?action=token"),{credentials:"same-origin"}).then(function(e){return e.json()}).then(function(e){e.ok&&e.token&&document.querySelectorAll('input[name="csrf"]').forEach(function(t){t.value=e.token})}).catch(function(){})}}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,a,i,c=[],l=!0,d=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(o=a.call(n)).done)&&(c.push(o.value),c.length!==t);l=!0);}catch(e){d=!0,r=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(d)throw r}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function s(){var e,t=(null===(e=document.querySelector(".search-bar"))||void 0===e?void 0:e.value.toLowerCase())||"";document.querySelectorAll(".folders li").forEach(function(e){var n=e.textContent.toLowerCase();e.style.display=n.includes(t)?"":"none"})}function u(e){document.documentElement.className="","default"!==e&&document.documentElement.classList.add("".concat(e,"-theme")),document.body.classList.remove("light-mode"),"undefined"!=typeof themeTypes&&"light"===themeTypes[e]&&document.body.classList.add("light-mode")}function m(){document.querySelectorAll("[data-generate-cert]").forEach(function(e){e.addEventListener("click",function(){var t=e.dataset.generateCert;confirm("Generate a new SSL certificate for "+t+"?")&&fetch("".concat(window.BASE_URL,"utils/generate_cert.php?name=").concat(encodeURIComponent(t))).then(function(e){return e.text()}).then(function(e){if(alert(e),e.includes("successfully")){var t=document.getElementById("restart-apache");t&&t.click()}}).catch(function(){return alert("Failed to run cert script.")})})})}function f(){var e=document.getElementById("vhost-filter"),t=document.querySelectorAll("#vhosts-table tbody tr");e&&t.length&&e.addEventListener("change",function(){var n=e.value,o=0;t.forEach(function(e){var t=e.classList.contains("vhost-ssl"),r=e.classList.contains("cert-valid"),a=e.classList.contains("host-valid"),i=!0;"missing-cert"===n?i=!r:"missing-host"===n?i=!a:"ssl-only"===n?i=t:"non-ssl"===n&&(i=!t),e.style.display=i?"":"none",i&&o++});var r=document.getElementById("vhost-empty-msg");r&&(r.style.display=0===o?"":"none")})}function p(){document.addEventListener("click",function(e){if(e.target.matches(".open-folder")){var t=e.target.dataset.path.replace(/^"(.*)"$/,"$1");t&&fetch("".concat(window.BASE_URL,"utils/open_folder.php"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t})})}})}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,a,i,c=[],l=!0,d=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(o=a.call(n)).done)&&(c.push(o.value),c.length!==t);l=!0);}catch(e){d=!0,r=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(d)throw r}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}document.addEventListener("DOMContentLoaded",function(){e(),setInterval(e,1e3)}),document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector(".columns");if(e){var t=["max-xs","max-sm","max-md","max-lg"],a=localStorage.getItem("columnSize");a&&t.includes(a)&&o(a);var i=document.getElementById("reset-width"),c=document.getElementById("prev-width"),l=document.getElementById("next-width");i&&i.addEventListener("click",function(){return o("auto")}),c&&c.addEventListener("click",function(){return r("prev",t)}),l&&l.addEventListener("click",function(){return r("next",t)});var d=JSON.parse(localStorage.getItem("columnOrder")||"[]");Array.isArray(d)&&d.length&&d.forEach(function(t){var n=document.getElementById(t);n&&n.classList.contains("column")&&!n.classList.contains("column-controls")&&e.appendChild(n)}),n(".columns",{items:".column:not(.column-controls)",handle:".drag-handle"}),e.addEventListener("sorted",function(){var t=Array.from(e.querySelectorAll(":scope > .column:not(.column-controls)")).map(function(e){return e.id}).filter(Boolean);localStorage.setItem("columnOrder",JSON.stringify(t))})}}),document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("dock-list"),t=document.getElementById("add-dock-item"),o=document.querySelector("#settings-view form");function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=document.createElement("li");n.className="dock-item",n.innerHTML='\n\t\t\t\t<input type="text" placeholder="Label" value="'.concat(t.label||"",'">\n\t\t\t\t<input type="text" placeholder="URL" value="').concat(t.url||"",'">\n\t\t\t\t<input type="text" placeholder="Icon" value="').concat(t.icon||"",'">\n\t\t\t\t<input type="text" placeholder="Alt Text" value="').concat(t.alt||"",'">\n\t\t\t\t<button type="button" class="remove-dock-item">‚ùå</button>\n\t\t\t'),e.appendChild(n),n.querySelector(".remove-dock-item").addEventListener("click",function(){n.remove(),a()}),Array.from(n.querySelectorAll("input")).forEach(function(e){e.addEventListener("input",a)})}function a(){var t=[];Array.from(e.children).forEach(function(e){var n=e.querySelectorAll("input");n.length<4||t.push({label:n[0].value.trim(),url:n[1].value.trim(),icon:n[2].value.trim(),alt:n[3].value.trim()})});var n=document.getElementById("dock_json_input");n&&(n.value=JSON.stringify(t,null,2))}e&&t&&o&&(fetch("".concat(window.BASE_URL,"utils/read_config.php?file=dock"),{cache:"no-store"}).then(function(e){return e.json()}).then(function(t){t.forEach(r),n("#dock-list"),e.addEventListener("sorted",a),a()}),t.addEventListener("click",function(){r(),n("#dock-list"),a()}))}),document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("folders-config-list"),t=document.getElementById("add-folder-column"),o=document.getElementById("folders_json_input");if(e&&t&&o){var r=[],a='<option value="">(none)</option>',i=!1,l=null;e.addEventListener("input",function(e){e.target.matches('input[type="text"], select')&&f()}),e.addEventListener("change",function(e){e.target.matches('select, input[type="checkbox"]')&&f()}),e.addEventListener("click",function(e){if(e.target.closest(".add-special")){var t,n=null===(t=e.target.closest(".folder-config-item"))||void 0===t?void 0:t.querySelector(".special-cases");n&&(n.insertAdjacentHTML("beforeend",s()),f())}if(e.target.closest(".remove-special")){var o=e.target.closest(".special-case");o&&(o.remove(),f())}if(e.target.closest(".remove-folder-column")){var r=e.target.closest(".folder-config-item");r&&(r.remove(),f())}}),e.addEventListener("sorted",function(){i=!0,p()}),Promise.all([fetch("".concat(window.BASE_URL,"utils/read_config.php?file=folders"),{cache:"no-store"}).then(function(e){return e.json()}).catch(function(){return[]}),Array.isArray(window.LINK_TEMPLATES)?(r=window.LINK_TEMPLATES.map(function(e){return e&&"string"==typeof e.name?e.name.trim():""}).filter(Boolean),r=Array.from(new Set(r)),a='<option value="">(none)</option>'+r.map(function(e){return'<option value="'.concat(e,'">').concat(e,"</option>")}).join(""),Promise.resolve(r)):fetch("".concat(window.BASE_URL,"utils/read_config.php?file=link_templates"),{cache:"no-store"}).then(function(e){return e.json()}).then(function(e){return r=(Array.isArray(e)?e:[]).map(function(e){return e&&"string"==typeof e.name?e.name.trim():""}).filter(Boolean),r=Array.from(new Set(r)),a='<option value="">(none)</option>'+r.map(function(e){return'<option value="'.concat(e,'">').concat(e,"</option>")}).join(""),r}).catch(function(){return a='<option value="">(none)</option>',r=[]})]).then(function(t){var o,a,l,d=c(t,1)[0];n("#folders-config-list"),Array.isArray(d)&&d.length&&(o=d,a=document.createDocumentFragment(),(l=document.createElement("div")).innerHTML=o.map(u).join(""),Array.from(l.children).forEach(function(e){return a.appendChild(e)}),e.appendChild(a),e.querySelectorAll(".folder-config-item").forEach(function(e){var t=e.querySelector(".link-template-select");if(t){var n,a=(null===(n=e.querySelector('input[data-key="title"]'))||void 0===n?void 0:n.value)||"",i=o.find(function(e){return(e.title||"")===a}),c=(null==i?void 0:i.linkTemplate)||"";c&&(t.value=c),t.disabled=0===r.length}})),0===e.children.length&&m({}),i=!0,p()}),t.addEventListener("click",function(){m({})})}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.match||"",n=e.replace||"";return'\n\t\t\t\t<div class="special-case">\n\t\t\t\t\t<input type="text" class="sc-match" placeholder="Match Regex" value="'.concat(t,'">\n\t\t\t\t\t<input type="text" class="sc-replace" placeholder="Replace Regex" value="').concat(n,'">\n\t\t\t\t\t<button type="button" class="remove-special">‚úñ</button>\n\t\t\t\t</div>\n\t\t\t')}function u(){var e,t,n,o,r,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(r=i.specialCases,r&&"object"===d(r)&&!Array.isArray(r)?Object.entries(r).map(function(e){var t=c(e,2),n=t[0],o=t[1];return{match:String(null!=n?n:""),replace:String(null!=o?o:"")}}):[]).map(s).join("");return i.linkTemplate,'\n\t\t\t\t<li class="folder-config-item">\n\t\t\t\t\t<input type="text" data-key="title" placeholder="Title" value="'.concat(i.title||"",'">\n\t\t\t\t\t<input type="text" data-key="href" placeholder="Href (optional)" value="').concat(i.href||"",'">\n\t\t\t\t\t<input type="text" data-key="dir" placeholder="Dir (relative to HTDOCS_PATH)" value="').concat(i.dir||"",'">\n\t\t\t\t\t<input type="text" data-key="excludeList" placeholder="Exclude List (comma-separated)" value="').concat((i.excludeList||[]).join(","),'">\n\t\t\t\t\t<input type="text" data-key="match" placeholder="Match Regex" value="').concat(null!==(e=null===(t=i.urlRules)||void 0===t?void 0:t.match)&&void 0!==e?e:"",'">\n\t\t\t\t\t<input type="text" data-key="replace" placeholder="Replace Regex" value="').concat(null!==(n=null===(o=i.urlRules)||void 0===o?void 0:o.replace)&&void 0!==n?n:"",'">\n\t\t\t\t\t<label>Link Template:\n\t\t\t\t\t\t<select class="link-template-select" name="linkTemplate">').concat(a,'</select>\n\t\t\t\t\t</label>\n\t\t\t\t\t<label><input type="checkbox" class="disable-links"').concat(i.disableLinks?" checked":"",'> Disable Links</label>\n\n\t\t\t\t\t<div class="special-cases-wrapper">\n\t\t\t\t\t\t<label>Special Cases:</label>\n\t\t\t\t\t\t<div class="special-cases">').concat(l,'</div>\n\t\t\t\t\t\t<button type="button" class="add-special">‚ûï Add Rule</button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<button type="button" class="remove-folder-column">‚ùå</button>\n\t\t\t\t</li>\n\t\t\t')}function m(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=document.createElement("div");n.innerHTML=u(t);var o=n.firstElementChild;e.appendChild(o);var a=o.querySelector(".link-template-select");a&&(a.disabled=0===r.length,t.linkTemplate&&(a.value=t.linkTemplate)),f()}function f(){i=!0,l&&clearTimeout(l),l=setTimeout(p,120)}function p(){var t;l=null,i&&(o.value=JSON.stringify((t=[],e.querySelectorAll(".folder-config-item").forEach(function(e){var n,o,r,a,i,c,l,d,s=function(t){return e.querySelector(t)},u=(null===(n=s('input[data-key="title"]'))||void 0===n?void 0:n.value.trim())||"",m=(null===(o=s('input[data-key="href"]'))||void 0===o?void 0:o.value.trim())||"",f=(null===(r=s('input[data-key="dir"]'))||void 0===r?void 0:r.value.trim())||"",p=(null===(a=s('input[data-key="excludeList"]'))||void 0===a?void 0:a.value)||"",v=(null===(i=s('input[data-key="match"]'))||void 0===i?void 0:i.value)||"",h=(null===(c=s('input[data-key="replace"]'))||void 0===c?void 0:c.value)||"",g=(null===(l=e.querySelector(".link-template-select"))||void 0===l?void 0:l.value)||"",y=!(null===(d=e.querySelector(".disable-links"))||void 0===d||!d.checked),E=[];e.querySelectorAll(".special-case").forEach(function(e){var t,n,o=(null===(t=e.querySelector(".sc-match"))||void 0===t?void 0:t.value)||"",r=(null===(n=e.querySelector(".sc-replace"))||void 0===n?void 0:n.value)||"";(o.length||r.length)&&E.push({match:o,replace:r})});var L,S=(L={},E.forEach(function(e){var t=e.match,n=void 0===t?"":t,o=e.replace,r=void 0===o?"":o,a=String(n).trim(),i=String(r).trim();(a.length||i.length)&&(L[a]=i)}),L),b=p.split(",").map(function(e){return e.trim()}).filter(Boolean),w={title:u,href:m,dir:f,excludeList:b,urlRules:{match:v,replace:h},linkTemplate:g,disableLinks:y,specialCases:S};(u||m||f||b.length||v||h||g||y||Object.keys(S).length)&&t.push(w)}),t),null,2),i=!1)}}),document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("link-templates-list"),t=document.getElementById("add-link-template");function n(){var t=[];e.querySelectorAll(".template-item").forEach(function(e){var n,o,r=null===(n=e.querySelector(".template-name"))||void 0===n?void 0:n.value.trim(),a=null===(o=e.querySelector(".template-html"))||void 0===o?void 0:o.value.trim();r&&a&&t.push({name:r,html:a})});var n=document.getElementById("link_templates_json_input");n&&(n.value=JSON.stringify(t,null,2))}function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=document.createElement("li");o.className="template-item",o.innerHTML='\n        <input type="text" class="template-name" placeholder="Template Name" value="'.concat(t.name||"",'">\n        <input type="text" class="template-html" placeholder="HTML Template" value="').concat(t.html||"",'">\n        <button type="button" class="remove-template">‚ùå</button>\n      '),o.querySelector(".remove-template").addEventListener("click",function(){o.remove(),n()}),Array.from(o.querySelectorAll("input")).forEach(function(e){e.addEventListener("input",n)}),e.appendChild(o),n()}e&&t&&(t.addEventListener("click",function(){return o()}),e.innerHTML="",fetch("".concat(window.BASE_URL,"utils/read_config.php?file=link_templates"),{cache:"no-store"}).then(function(e){return e.json()}).then(function(e){e.forEach(o),n()}))}),a({sectionId:"apache-error-log-section",toggleButtonId:"toggle-apache-error-log",logElementId:"apache-error-log",endpoint:"utils/apache_error_log.php"}),a({sectionId:"php-error-log-section",toggleButtonId:"toggle-php-error-log",logElementId:"php-error-log",endpoint:"utils/php_error_log.php"}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){return i()}):i(),document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector(".search-bar");e&&e.addEventListener("input",s)}),document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("clear-local-storage");e&&e.addEventListener("click",function(){if(confirm("Are you sure you want to reset saved UI settings?")){var e=["theme","columnOrder","columnSize"];Object.keys(localStorage).forEach(function(t){e.some(function(e){return t.startsWith(e)})&&localStorage.removeItem(t)}),alert("Saved settings have been cleared from local storage."),location.reload()}})}),document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector(".post-confirmation-container");e&&setTimeout(function(){e.style.transition="opacity 0.5s ease",e.style.opacity="0",setTimeout(function(){return e.remove()},500)},3e3)}),document.addEventListener("DOMContentLoaded",function(){var e=document.body;if(document.getElementById("system-monitor")&&"true"===e.getAttribute("data-ajax-enabled")){var t=document.getElementById("cpu-load"),n=document.getElementById("memory-usage"),o=document.getElementById("disk-space");fetch("".concat(window.BASE_URL,"utils/system_stats.php"),{cache:"no-store"}).then(function(e){if(e.ok)return e.json()}).then(function(e){t.textContent="".concat(e.cpu,"%"),n.textContent="".concat(e.memory," MB"),o.textContent="".concat(e.disk,"%"),setInterval(r,1e3),r()}).catch(function(){})}function r(){fetch("".concat(window.BASE_URL,"utils/system_stats.php"),{cache:"no-store"}).then(function(e){if(!e.ok)throw new Error("System stats unavailable");return e.json()}).then(function(e){t.textContent="".concat(e.cpu,"%"),n.textContent="".concat(e.memory," MB"),o.textContent="".concat(e.disk,"%")})}}),document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector("#theme-selector");if(e){var t=localStorage.getItem("theme")||serverTheme||"default";u(t),e.value=t,e.addEventListener("change",function(e){var t=e.target.value;u(t),localStorage.setItem("theme",t)})}}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){m(),f(),p()}):(m(),f(),p()),document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".toggle-content-container").forEach(function(e,t){if("1"!==e.dataset.accordionInit){e.dataset.accordionInit="1";var n=e.querySelector(".toggle-accordion"),o=e.querySelector(".toggle-content");if(n&&o){var r=parseInt(o.dataset.collapsedHeight)||0,a=e.dataset.id||"accordion-"+t,i="open"===localStorage.getItem("accordion_"+a);e.classList.toggle("open",i),n.setAttribute("aria-expanded",i?"true":"false"),i?(o.hidden=!1,o.style.height=o.scrollHeight+"px",requestAnimationFrame(function(){o.style.height="auto"})):(o.style.height=r+"px",o.hidden=!0),n.addEventListener("click",function(e){var t;e.stopPropagation(),t=".tooltip-icon",e.target.closest(t)||c()}),n.addEventListener("keydown",function(t){if(" "===t.key||"Enter"===t.key)t.preventDefault(),c();else if("ArrowDown"===t.key&&e.classList.contains("open")&&!o.hidden){var n=o.querySelector('a,button,input,select,textarea,[tabindex]:not([tabindex="-1"])');n&&n.focus()}})}}function c(){e.classList.contains("open")?(e.classList.remove("open"),n.setAttribute("aria-expanded","false"),o.style.height=o.scrollHeight+"px",o.offsetHeight,requestAnimationFrame(function(){o.style.height=r+"px";var e=function(t){t.target===o&&"height"===t.propertyName&&(o.hidden=!0,o.removeEventListener("transitionend",e))};o.addEventListener("transitionend",e)}),localStorage.setItem("accordion_"+a,"closed")):(o.hidden=!1,e.classList.add("open"),n.setAttribute("aria-expanded","true"),o.style.height=r+"px",requestAnimationFrame(function(){var e=o.scrollHeight;o.style.height=e+"px";var t=function(e){e.target===o&&"height"===e.propertyName&&(o.style.height="auto",o.removeEventListener("transitionend",t))};o.addEventListener("transitionend",t)}),localStorage.setItem("accordion_"+a,"open"))}}),window.addEventListener("resize",function(){document.querySelectorAll(".toggle-content-container.open .toggle-content").forEach(function(e){e.hidden||"auto"===e.style.height||(e.style.height=e.scrollHeight+"px")})})}),document.addEventListener("DOMContentLoaded",function(){var e={index:document.getElementById("folders-view"),settings:document.getElementById("settings-view"),phpinfo:document.getElementById("phpinfo-view"),apache:document.getElementById("apache-view"),mysql:document.getElementById("mysql-view")},t={index:"index",settings:"settings",phpinfo:"phpinfo","apache-inspector":"apache","mysql-inspector":"mysql"};function n(){return new URLSearchParams(window.location.search).get("view")||"index"}function o(n){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t[n]||"index";if(Object.entries(e).forEach(function(e){var t=v(e,2),n=t[0],o=t[1];o&&o.classList.toggle("visible",n===r)}),"apache"===r||"mysql"===r){var a=e[r];if(a&&!a.dataset.loaded){a.innerHTML='<div class="loader"><span class="spinner" role="img" aria-label="Loading"></span></div>';var i="utils/".concat(r,"_inspector.php");fetch("".concat(window.BASE_URL||"/").concat(i)).then(function(e){return e.text()}).then(function(e){a.innerHTML=e,a.dataset.loaded="true"}).catch(function(e){a.innerHTML='<p class="error">Failed to load '.concat(i,"</p>"),console.error("[view.js] Failed to fetch ".concat(i),e)})}}if(o){var c=window.BASE_URL||window.location.pathname,l="index"===r?"":"?view="+encodeURIComponent(n);history.pushState({},"",c+l)}}Object.entries({"toggle-index":"index","toggle-settings":"settings","toggle-phpinfo":"phpinfo","toggle-apache-inspector":"apache-inspector","toggle-mysql-inspector":"mysql-inspector"}).forEach(function(e){var t=v(e,2),n=t[0],r=t[1],a=document.getElementById(n);a&&a.addEventListener("click",function(e){e.preventDefault(),o(r,!0)})}),o(n()),window.addEventListener("popstate",function(){o(n())})})})();
//# sourceMappingURL=script.min.js.map