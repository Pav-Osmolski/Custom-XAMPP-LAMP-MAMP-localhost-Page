(()=>{"use strict";function e(){const e=document.querySelector(".clock");if(e){const t=new Date;e.textContent=t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}}function t(e){localStorage.setItem("columnSize",e);const t=document.querySelector(".columns");t&&(t.classList.forEach((e=>{e.startsWith("max-")&&t.classList.remove(e)})),"auto"!==e&&t.classList.add(e))}function n(e,n){let o=localStorage.getItem("columnSize"),a=n.indexOf(o);-1===a&&(a="next"===e?-1:0),"next"===e&&a<n.length-1?a+=1:"prev"===e&&a>0&&(a-=1),t(n[a])}function o(e){const t=document.querySelector(e);if(!t)return;let n=null;function o(e){n=this,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",this.outerHTML),this.classList.add("dragElem")}function a(e){return e.preventDefault&&e.preventDefault(),this.classList.add("over"),e.dataTransfer.dropEffect="move",!1}function l(){this.classList.add("over")}function c(){this.classList.remove("over")}function s(e){if(e.stopPropagation&&e.stopPropagation(),n!==this){const t=e.dataTransfer.getData("text/html"),o=document.createElement("div");o.innerHTML=t.trim();const a=o.firstChild,l=this.getBoundingClientRect();e.clientY-l.top>l.height/2?this.after(a):this.before(a),n.remove(),d(a)}return this.classList.remove("over"),!1}function r(){this.classList.remove("over"),this.classList.remove("dragElem")}function d(e){e.addEventListener("dragstart",o),e.addEventListener("dragenter",l),e.addEventListener("dragover",a),e.addEventListener("dragleave",c),e.addEventListener("drop",s),e.addEventListener("dragend",r)}Array.from(t.children).forEach(d)}function a({sectionId:e,toggleButtonId:t,logElementId:n,endpoint:o}){document.addEventListener("DOMContentLoaded",(()=>{const a=document.body;if(!document.getElementById(e))return;const l=document.getElementById(t),c=document.getElementById(n);function s(e){const t=""===e.trim();c.innerHTML=t?'<code class="muted">No errors logged. You\'re doing great. üéâ</code>':`<code>${e}</code>`}function r(){fetch(`${window.BASE_URL}${o}`,{cache:"no-store"}).then((e=>e.ok?e.text():Promise.reject())).then(s)}l&&c&&(l.addEventListener("click",(function(){const e=c.classList.contains("visible");c.classList.toggle("visible",!e),this.setAttribute("aria-expanded",!e)})),"true"===a.getAttribute("data-ajax-enabled")&&fetch(`${window.BASE_URL}${o}`,{cache:"no-store"}).then((e=>e.ok?e.text():Promise.reject())).then((e=>{s(e),setInterval(r,3e3)})).catch((()=>{})))}))}function l(){const e=document.querySelector(".search-bar")?.value.toLowerCase()||"";document.querySelectorAll(".folders li").forEach((t=>{const n=t.textContent.toLowerCase();t.style.display=n.includes(e)?"":"none"}))}function c(e){document.documentElement.className="","default"!==e&&document.documentElement.classList.add(`${e}-theme`),document.body.classList.remove("light-mode"),"undefined"!=typeof themeTypes&&"light"===themeTypes[e]&&document.body.classList.add("light-mode")}function s(){document.querySelectorAll("[data-generate-cert]").forEach((e=>{e.addEventListener("click",(()=>{const t=e.dataset.generateCert;confirm("Generate a new SSL certificate for "+t+"?")&&fetch(`${window.BASE_URL}utils/generate_cert.php?name=${encodeURIComponent(t)}`).then((e=>e.text())).then((e=>{if(alert(e),e.includes("successfully")){const e=document.getElementById("restart-apache");e&&e.click()}})).catch((()=>alert("Failed to run cert script.")))}))}))}function r(){const e=document.getElementById("vhost-filter"),t=document.querySelectorAll("#vhosts-table tbody tr");e&&t.length&&e.addEventListener("change",(()=>{const n=e.value;let o=0;t.forEach((e=>{const t=e.classList.contains("vhost-ssl"),a=e.classList.contains("cert-valid"),l=e.classList.contains("host-valid");let c=!0;"missing-cert"===n?c=!a:"missing-host"===n?c=!l:"ssl-only"===n?c=t:"non-ssl"===n&&(c=!t),e.style.display=c?"":"none",c&&o++}));const a=document.getElementById("vhost-empty-msg");a&&(a.style.display=0===o?"":"none")}))}function d(){document.addEventListener("click",(e=>{if(e.target.matches(".open-folder")){const t=e.target.dataset.path.replace(/^"(.*)"$/,"$1");t&&fetch(`${window.BASE_URL}utils/open_folder.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t})})}}))}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("restart-apache-button");e&&e.addEventListener("click",(()=>function(e){const t=document.getElementById("apache-status-message");t&&(t.innerText="Executing "+e+"...",fetch(`${window.BASE_URL}utils/toggle_apache.php`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"action="+encodeURIComponent(e)}).then((e=>e.text())).then((e=>{try{const n=JSON.parse(e);t.innerText=n.message,"function"==typeof renderServerInfo&&renderServerInfo()}catch(n){console.error("Invalid JSON:",e),t.innerText="Error: Invalid server response"}})).catch((e=>{t.innerText="Error: "+e})))}("restart")))})),document.addEventListener("DOMContentLoaded",(()=>{e(),setInterval(e,1e3)})),function(){const e=["max-xs","max-sm","max-md","max-lg"];document.addEventListener("DOMContentLoaded",(()=>{const o=localStorage.getItem("columnSize");o&&t(o);const a=document.getElementById("reset-width"),l=document.getElementById("prev-width"),c=document.getElementById("next-width");a&&a.addEventListener("click",(()=>t("auto"))),l&&l.addEventListener("click",(()=>n("prev",e))),c&&c.addEventListener("click",(()=>n("next",e)))})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector(".columns");if(!e)return;let t=null;const n=JSON.parse(localStorage.getItem("columnOrder")||"[]");n.length&&n.forEach((t=>{const n=document.getElementById(t);n&&e.appendChild(n)})),e.querySelectorAll(".column:not(.column-controls)").forEach((n=>{const o=n.querySelector(".drag-handle");o&&(n.setAttribute("draggable",!1),o.addEventListener("mousedown",(()=>{n.setAttribute("draggable",!0)})),o.addEventListener("mouseup",(()=>{n.setAttribute("draggable",!1)})),n.addEventListener("dragstart",(()=>{t=n,n.style.opacity="0.5"})),n.addEventListener("dragend",(()=>{t=null,n.style.opacity="1",n.setAttribute("draggable",!1),function(){const t=Array.from(e.children).filter((e=>!e.classList.contains("column-controls"))).map((e=>e.id));localStorage.setItem("columnOrder",JSON.stringify(t))}()})),n.addEventListener("dragover",(e=>e.preventDefault())),n.addEventListener("drop",(o=>{if(o.preventDefault(),t&&t!==n){const o=[...e.children],a=o.indexOf(n);o.indexOf(t)<a?n.after(t):n.before(t)}})))}))}))}(),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("dock-list"),t=document.getElementById("add-dock-item"),n=document.querySelector("#settings-view form");function a(t={}){const n=document.createElement("li");n.className="dock-item",n.draggable=!0,n.innerHTML=`\n                <input type="text" placeholder="Label" value="${t.label||""}">\n                <input type="text" placeholder="URL" value="${t.url||""}">\n                <input type="text" placeholder="Icon" value="${t.icon||""}">\n                <input type="text" placeholder="Alt Text" value="${t.alt||""}">\n                <button type="button" class="remove-dock-item">‚ùå</button>\n            `,e.appendChild(n),n.querySelector(".remove-dock-item").addEventListener("click",(()=>{n.remove(),l()})),Array.from(n.querySelectorAll("input")).forEach((e=>{e.addEventListener("input",l)}))}function l(){const t=[];e.querySelectorAll(".dock-item").forEach((e=>{const n=e.querySelectorAll("input");t.push({label:n[0].value.trim(),url:n[1].value.trim(),icon:n[2].value.trim(),alt:n[3].value.trim()})}));const n=document.getElementById("dock_json_input");n&&(n.value=JSON.stringify(t,null,2))}e&&t&&n&&(fetch(`${window.BASE_URL}config/dock.json`,{cache:"no-store"}).then((e=>e.json())).then((e=>{e.forEach(a),o("#dock-list"),l()})),t.addEventListener("click",(()=>{a(),o("#dock-list"),l()})))})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("folders-config-list"),t=document.getElementById("add-folder-column"),n=document.getElementById("folders_json_input");if(!e||!t||!n)return;let a=null;const l=(e,t)=>{(a?Promise.resolve(a):fetch(`${window.BASE_URL}config/link_templates.json`,{cache:"no-store"}).then((e=>e.json())).then((e=>(a=e,e)))).then((n=>{let o=!1;if(n.forEach((n=>{const a=document.createElement("option");a.value=n.name,a.textContent=n.name,n.name===t&&(a.selected=!0,o=!0),e.appendChild(a)})),!o&&t){const n=document.createElement("option");n.value=t,n.textContent=t,n.selected=!0,e.appendChild(n)}s()}))},c=(t={})=>{const n=document.createElement("li");n.className="folder-config-item",n.draggable=!0;const o=((e={})=>Object.entries(e).map((([e,t])=>`\n\t\t\t\t\t<div class="special-case">\n\t\t\t\t\t\t<input type="text" class="case-key" placeholder="match" value="${e}">\n\t\t\t\t\t\t<input type="text" class="case-val" placeholder="replacement" value="${t}">\n\t\t\t\t\t\t<button type="button" class="remove-special">‚ùå</button>\n\t\t\t\t\t</div>\n\t\t\t\t`)).join(""))(t.specialCases);n.innerHTML=`\n\t\t\t\t<input type="text" data-key="title" placeholder="Title" value="${t.title||""}">\n\t\t\t\t<input type="text" data-key="href" placeholder="Href (optional)" value="${t.href||""}">\n\t\t\t\t<input type="text" data-key="dir" placeholder="Dir (relative to HTDOCS_PATH)" value="${t.dir||""}">\n\t\t\t\t<input type="text" data-key="excludeList" placeholder="Exclude List (comma-separated)" value="${(t.excludeList||[]).join(",")}">\n\t\t\t\t<input type="text" data-key="match" placeholder="Match Regex" value="${t.urlRules?.match??""}">\n\t\t\t\t<input type="text" data-key="replace" placeholder="Replace Regex" value="${t.urlRules?.replace??""}">\n\t\t\t\t<label>Link Template: <select class="link-template-select" name="linkTemplate"></select></label>\n\t\t\t\t<label><input type="checkbox" class="disable-links" ${t.disableLinks?"checked":""}> Disable Links</label>\n\t\t\t\t<div class="special-cases-wrapper">\n\t\t\t\t\t<label>Special Cases:</label>\n\t\t\t\t\t<div class="special-cases">${o}</div>\n\t\t\t\t\t<button type="button" class="add-special">‚ûï Add Rule</button>\n\t\t\t\t</div>\n\t\t\t\t<button type="button" class="remove-folder-column">‚ùå</button>\n\t\t\t`,e.appendChild(n),n.querySelector('input[data-key="title"]').focus();const a=n.querySelector(".link-template-select");l(a,t.linkTemplate),n.querySelector(".remove-folder-column").addEventListener("click",(()=>{n.remove(),s()})),n.querySelector(".add-special").addEventListener("click",(()=>{const e=n.querySelector(".special-cases"),t=document.createElement("div");t.className="special-case",t.innerHTML='\n\t\t\t\t\t<input type="text" class="case-key" placeholder="match">\n\t\t\t\t\t<input type="text" class="case-val" placeholder="replacement">\n\t\t\t\t\t<button type="button" class="remove-special">‚ùå</button>\n\t\t\t\t',e.appendChild(t)})),n.querySelector(".special-cases").addEventListener("click",(e=>{e.target.matches(".remove-special")&&(e.target.closest(".special-case").remove(),s())})),n.querySelectorAll("input, select").forEach((e=>{e.addEventListener("input",s),e.addEventListener("change",s)}))},s=()=>{const t=[];e.querySelectorAll(".folder-config-item").forEach((e=>{const n=t=>e.querySelector(t)?.value.trim()||"",o={};e.querySelectorAll(".special-case").forEach((e=>{const t=e.querySelector(".case-key").value.trim(),n=e.querySelector(".case-val").value.trim();t&&(o[t]=n)})),t.push({title:n('input[data-key="title"]'),href:n('input[data-key="href"]'),dir:n('input[data-key="dir"]'),excludeList:n('input[data-key="excludeList"]').split(",").map((e=>e.trim())).filter(Boolean),urlRules:{match:n('input[data-key="match"]'),replace:n('input[data-key="replace"]')},linkTemplate:e.querySelector(".link-template-select")?.value||"",disableLinks:e.querySelector(".disable-links")?.checked||!1,specialCases:o})})),n.value=JSON.stringify(t,null,2)};fetch(`${window.BASE_URL}config/folders.json`,{cache:"no-store"}).then((e=>e.json())).then((e=>{e.forEach((e=>c(e))),o("#folders-config-list")})),t.addEventListener("click",(()=>{c(),s()}))})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("link-templates-list"),t=document.getElementById("add-link-template");function n(){const t=[];e.querySelectorAll(".template-item").forEach((e=>{const n=e.querySelector(".template-name")?.value.trim(),o=e.querySelector(".template-html")?.value.trim();n&&o&&t.push({name:n,html:o})}));const n=document.getElementById("link_templates_json_input");n&&(n.value=JSON.stringify(t,null,2))}function o(t={}){const o=document.createElement("li");o.className="template-item",o.innerHTML=`\n        <input type="text" class="template-name" placeholder="Template Name" value="${t.name||""}">\n        <input type="text" class="template-html" placeholder="HTML Template" value="${t.html||""}">\n        <button type="button" class="remove-template">‚ùå</button>\n      `,o.querySelector(".remove-template").addEventListener("click",(()=>{o.remove(),n()})),Array.from(o.querySelectorAll("input")).forEach((e=>{e.addEventListener("input",n)})),e.appendChild(o),n()}e&&t&&(t.addEventListener("click",(()=>o())),e.innerHTML="",fetch("config/link_templates.json",{cache:"no-store"}).then((e=>e.json())).then((e=>{e.forEach(o),n()})))})),a({sectionId:"apache-error-log-section",toggleButtonId:"toggle-apache-error-log",logElementId:"apache-error-log",endpoint:"utils/apache_error_log.php"}),a({sectionId:"php-error-log-section",toggleButtonId:"toggle-php-error-log",logElementId:"php-error-log",endpoint:"utils/php_error_log.php"}),document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector(".search-bar");e&&e.addEventListener("input",l)})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("clear-local-storage");e&&e.addEventListener("click",(()=>{if(!confirm("Are you sure you want to reset saved UI settings?"))return;const e=["theme","columnOrder","columnSize"];Object.keys(localStorage).forEach((t=>{e.some((e=>t.startsWith(e)))&&localStorage.removeItem(t)})),alert("Saved settings have been cleared from local storage."),location.reload()}))})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.body;if(!document.getElementById("system-monitor"))return;if("true"!==e.getAttribute("data-ajax-enabled"))return;const t=document.getElementById("cpu-load"),n=document.getElementById("memory-usage"),o=document.getElementById("disk-space");let a;function l(){fetch(`${window.BASE_URL}utils/system_stats.php`,{cache:"no-store"}).then((e=>{if(!e.ok)throw new Error("System stats unavailable");return e.json()})).then((e=>{t.textContent=`${e.cpu}%`,n.textContent=`${e.memory} MB`,o.textContent=`${e.disk}%`}))}fetch(`${window.BASE_URL}utils/system_stats.php`,{cache:"no-store"}).then((e=>{if(e.ok)return e.json()})).then((e=>{t.textContent=`${e.cpu}%`,n.textContent=`${e.memory} MB`,o.textContent=`${e.disk}%`,a=setInterval(l,1e3),l()})).catch((()=>{}))})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#theme-selector");if(!e)return;const t=localStorage.getItem("theme")||serverTheme||"default";c(t),e.value=t,e.addEventListener("change",(e=>{const t=e.target.value;c(t),localStorage.setItem("theme",t)}))})),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{s(),r(),d()})):(s(),r(),d()),document.addEventListener("DOMContentLoaded",(()=>{const e={index:document.getElementById("folders-view"),settings:document.getElementById("settings-view"),phpinfo:document.getElementById("phpinfo-view"),apache:document.getElementById("apache-view"),mysql:document.getElementById("mysql-view")};Object.entries({"toggle-index":"index","toggle-settings":"settings","toggle-phpinfo":"phpinfo"}).forEach((([t,n])=>{const o=document.getElementById(t);o&&o.addEventListener("click",(t=>{t.preventDefault(),Object.entries(e).forEach((([e,t])=>{t&&t.classList.toggle("visible",e===n)}))}))})),Object.entries({"toggle-apache-inspector":{targetKey:"apache",url:"utils/apache_inspector.php"},"toggle-mysql-inspector":{targetKey:"mysql",url:"utils/mysql_inspector.php"}}).forEach((([t,{targetKey:n,url:o}])=>{const a=document.getElementById(t),l=e[n];a&&l&&a.addEventListener("click",(async t=>{if(t.preventDefault(),Object.values(e).forEach((e=>{e&&e.classList.remove("visible")})),l.classList.add("visible"),!l.dataset.loaded){l.innerHTML='<div class="loader"><span class="spinner" role="img" aria-label="Loading"></span></div>';try{const e=await fetch(`${window.BASE_URL||"/"}${o}`);l.innerHTML=await e.text(),l.dataset.loaded="true"}catch(e){l.innerHTML='<p class="error">Failed to load '+o+"</p>",console.error(`[view.js] Failed to fetch ${o}`,e)}}}))}))}))})();
//# sourceMappingURL=script.min.js.map